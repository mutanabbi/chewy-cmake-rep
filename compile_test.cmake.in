#
# ATTENTION DO NOT EDIT! This file was generated by CMake!
#

# Set variables from "parent" context
set(add_compile_tests_DEBUG "@add_compile_tests_DEBUG@")
set(_compile_options @_compile_options@)
set(_compiler "@_compiler@")
set(_fake_cc "@_fake_cc@")
set(_output_dir "@_output_dir@")
set(_src_name "@_src_name@")
set(_src_rel_dir "@_src_rel_dir@")

# Prepare test file to compile
file(WRITE "${_fake_cc}" "#include <${_src_rel_dir}/${_src_name}>\nint main(){return 0;}\n")

# Finalize compiler command line
string(REPLACE "<OBJECT>" "${_fake_cc}.o" _compiler_options "${_compile_options}")
string(REPLACE "<SOURCE>" "${_fake_cc}" _compiler_options "${_compiler_options}")

# Try to compile
execute_process(
    COMMAND ${_compiler} ${_compiler_options}
    RESULT_VARIABLE _result
    OUTPUT_VARIABLE _output
    ERROR_VARIABLE _error
  )

string(REPLACE ";" " " _compiler_options "${_compiler_options}")

# Check the result
if(NOT _result EQUAL 0)
    # Write messages log to file
    file(
        WRITE "${_fake_cc}.log"
        "Checking ${_src_rel_dir}/${_src_name}\n"
        "Command line:\n"
        "${_compiler} ${_compiler_options}\n"
        "---[ Output ]---\n"
        "${_output}\n"
        "---[ Errors ]---\n"
        "${_error}"
      )
    message(FATAL_ERROR "Compile check failed: ${_src_rel_dir}/${_src_name}")
elseif(NOT add_compile_tests_DEBUG)
    # Cleanup results
    file(REMOVE "${_fake_cc}" "${_fake_cc}.o" "${_fake_cc}.log")
endif()
